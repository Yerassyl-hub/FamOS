# FamOS - Family Operating System

Полноценное приложение для автоматизации WhatsApp с AI-ассистентом, который изучает ваш стиль общения и может отвечать вместо вас.

## Возможности

✅ **Синхронизация всех чатов** - автоматическая загрузка всех текущих и старых чатов  
✅ **Анализ стиля общения** - система изучает вашу манеру общения, фразы, эмодзи, стиль  
✅ **Автоматические ответы** - AI может отвечать вместо вас в вашем стиле  
✅ **Ежедневные отчеты** - автоматическая генерация отчетов о вашей активности  
✅ **REST API** - полное управление через HTTP endpoints  

## Технологии

- **NestJS** - Backend framework
- **MongoDB** - База данных для хранения сообщений и чатов
- **Redis (BullMQ)** - Очередь для асинхронной обработки
- **whatsapp-web.js** - Интеграция с WhatsApp
- **TypeScript** - Типизированный JavaScript

## Установка

### Prerequisites

- Node.js (v18 или выше)
- Docker и Docker Compose
- npm или yarn

### Шаги установки

1. **Установите зависимости:**
   ```bash
   npm install
   ```

2. **Запустите Docker сервисы (MongoDB и Redis):**
   ```bash
   docker-compose up -d
   ```

3. **Запустите приложение:**
   ```bash
   npm run start:dev
   ```

4. **Отсканируйте QR код:**
   - Когда приложение запустится, в терминале появится QR код
   - Откройте WhatsApp на телефоне
   - Перейдите в Настройки → Связанные устройства
   - Нажмите "Связать устройство"
   - Отсканируйте QR код из терминала

## Использование

### 1. Синхронизация чатов

После подключения к WhatsApp система автоматически синхронизирует все чаты. Вы также можете запустить синхронизацию вручную:

```bash
curl -X POST http://localhost:3000/api/sync-chats
```

### 2. Анализ стиля общения

Проанализируйте ваши сообщения для создания профиля стиля:

```bash
curl -X POST http://localhost:3000/api/analyze-style
```

Система проанализирует до 10000 ваших сообщений и создаст профиль стиля общения.

### 3. Включение автоответов

Включите автоматические ответы:

```bash
curl -X POST http://localhost:3000/api/auto-reply \
  -H "Content-Type: application/json" \
  -d '{"enabled": true}'
```

Теперь система будет автоматически отвечать на входящие сообщения в вашем стиле.

### 4. Просмотр отчетов

Получите последние отчеты:

```bash
curl http://localhost:3000/api/reports
```

## API Endpoints

### Управление
- `GET /api/health` - Проверка статуса
- `POST /api/sync-chats` - Запустить синхронизацию чатов
- `POST /api/analyze-style` - Проанализировать стиль общения
- `GET /api/style` - Получить профиль стиля

### Автоответы
- `POST /api/auto-reply` - Включить/выключить автоответы (`{"enabled": true/false}`)
- `GET /api/auto-reply` - Статус автоответов

### Отчеты
- `GET /api/reports` - Последние отчеты (параметр `?limit=7`)
- `GET /api/reports/:date` - Отчет за конкретную дату (формат: `YYYY-MM-DD`)

### Статистика
- `GET /api/stats` - Общая статистика
- `GET /api/chats` - Список всех чатов
- `GET /api/chats/:chatId/messages` - Сообщения чата (параметры: `?limit=50&skip=0`)

## Структура проекта

```
FamOS/
├── server/
│   └── src/
│       ├── api/              # REST API контроллеры
│       ├── chat/             # Управление чатами
│       ├── chat-sync/        # Синхронизация чатов
│       ├── daily-report/     # Ежедневные отчеты
│       ├── message/          # Управление сообщениями
│       ├── message-processor/ # Обработка сообщений из очереди
│       ├── queue/            # Конфигурация Redis очереди
│       ├── user-style/       # Анализ стиля общения
│       ├── ai-response/      # Генерация ответов
│       ├── wa/               # WhatsApp интеграция
│       ├── app.module.ts
│       └── main.ts
├── docker-compose.yml
└── package.json
```

## Переменные окружения

- `MONGODB_URI`: MongoDB connection string (по умолчанию: `mongodb://localhost:27017/famos`)
- `REDIS_HOST`: Redis host (по умолчанию: `localhost`)
- `REDIS_PORT`: Redis port (по умолчанию: `6380`)
- `PORT`: Application port (по умолчанию: `3000`)

## Ежедневные отчеты

Система автоматически генерирует отчеты каждый день в 1:00 AM. Отчеты включают:

- Общее количество сообщений (входящие/исходящие)
- Активные чаты
- Топ контактов
- Активность по часам
- Insights и highlights

## Архитектура

Подробное описание архитектуры см. в [ARCHITECTURE.md](./ARCHITECTURE.md)

## Разработка

### Сборка

```bash
npm run build
```

### Запуск в продакшене

```bash
npm run start:prod
```

## Лицензия

UNLICENSED
