# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ FamOS

## üöÄ –ü—Ä–æ–º–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

–°–æ–∑–¥–∞–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è FamOS - —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ WhatsApp —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º.

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

### –°—Ç–µ–∫
- **Next.js 14** (App Router) + **TypeScript**
- **Tailwind CSS** –¥–ª—è —Å—Ç–∏–ª–µ–π
- **React Query (TanStack Query)** –¥–ª—è API
- **Recharts** –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
- **Axios** –¥–ª—è HTTP

### API Base URL
```
http://localhost:3000/api
```

## –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### 1. Dashboard (`/`)
- –°—Ç–∞—Ç—É—Å WhatsApp (–ø–æ–¥–∫–ª—é—á–µ–Ω/–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω, QR –∫–æ–¥)
- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Å–æ–æ–±—â–µ–Ω–∏—è, —á–∞—Ç—ã, –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã)
- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è, –∞–Ω–∞–ª–∏–∑ —Å—Ç–∏–ª—è)
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ç—á–µ—Ç—ã

### 2. WhatsApp Status (`/whatsapp`)
- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- QR –∫–æ–¥ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å, –æ—Ç–∫–ª—é—á–∏—Ç—å)
- –ò—Å—Ç–æ—Ä–∏—è –æ—à–∏–±–æ–∫

### 3. –ß–∞—Ç—ã (`/chats`)
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤
- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–æ–æ–±—â–µ–Ω–∏—è–º

### 4. –°–æ–æ–±—â–µ–Ω–∏—è (`/chats/[chatId]`)
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è
- –ü–æ–∏—Å–∫

### 5. –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã (`/auto-reply`)
- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å
- –°—Ç–∞—Ç—É—Å
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤

### 6. –ê–Ω–∞–ª–∏–∑ —Å—Ç–∏–ª—è (`/style`)
- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∞–ª–∏–∑–∞
- –ü—Ä–æ—Ñ–∏–ª—å —Å—Ç–∏–ª—è (—Ñ—Ä–∞–∑—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –≥—Ä–∞—Ñ–∏–∫–∏)

### 7. –û—Ç—á–µ—Ç—ã (`/reports`)
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –æ—Ç—á–µ—Ç–æ–≤
- –°–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤
- –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ API endpoints

### –°—Ç–∞—Ç—É—Å
```typescript
GET /api/status        // –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ (–ù–ï /status!)
GET /api/health        // Health check
GET /api/stats         // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```

### WhatsApp
```typescript
GET /api/whatsapp/status      // –°—Ç–∞—Ç—É—Å WhatsApp + QR –∫–æ–¥
POST /api/whatsapp/reconnect  // –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å
POST /api/whatsapp/disconnect // –û—Ç–∫–ª—é—á–∏—Ç—å
```

### –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã
```typescript
GET /api/auto-reply           // –°—Ç–∞—Ç—É—Å
POST /api/auto-reply          // { enabled: true/false }
```

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### React Hook –¥–ª—è WhatsApp —Å—Ç–∞—Ç—É—Å–∞
```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { api } from '@/lib/api/client';

export const useWhatsAppStatus = () => {
  return useQuery({
    queryKey: ['whatsapp-status'],
    queryFn: async () => {
      const { data } = await api.getWhatsAppStatus();
      return data;
    },
    refetchInterval: 5000, // –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
  });
};

export const useReconnectWhatsApp = () => {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: () => api.reconnectWhatsApp(),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['whatsapp-status'] });
    },
  });
};
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤
```tsx
'use client';

import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { api } from '@/lib/api/client';

export function AutoReplyToggle() {
  const queryClient = useQueryClient();
  
  const { data: status } = useQuery({
    queryKey: ['auto-reply'],
    queryFn: async () => {
      const { data } = await api.getAutoReplyStatus();
      return data;
    },
  });

  const toggleMutation = useMutation({
    mutationFn: (enabled: boolean) => api.toggleAutoReply(enabled),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['auto-reply'] });
      queryClient.invalidateQueries({ queryKey: ['stats'] });
    },
  });

  const handleToggle = () => {
    toggleMutation.mutate(!status?.autoReplyEnabled);
  };

  return (
    <div className="flex items-center gap-4">
      <label className="flex items-center cursor-pointer">
        <input
          type="checkbox"
          checked={status?.autoReplyEnabled || false}
          onChange={handleToggle}
          disabled={toggleMutation.isPending}
          className="sr-only peer"
        />
        <div className="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
        <span className="ml-3 text-sm font-medium">
          –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã {status?.autoReplyEnabled ? '–≤–∫–ª—é—á–µ–Ω—ã' : '–≤—ã–∫–ª—é—á–µ–Ω—ã'}
        </span>
      </label>
    </div>
  );
}
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç–∞—Ç—É—Å–∞ WhatsApp
```tsx
'use client';

import { useWhatsAppStatus, useReconnectWhatsApp } from '@/hooks/useWhatsApp';
import QRCode from 'qrcode.react';

export function WhatsAppStatusCard() {
  const { data: status, isLoading } = useWhatsAppStatus();
  const reconnect = useReconnectWhatsApp();

  if (isLoading) return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>;

  const statusColors = {
    ready: 'bg-green-500',
    authenticated: 'bg-green-500',
    connecting: 'bg-yellow-500',
    disconnected: 'bg-red-500',
  };

  return (
    <div className="bg-white rounded-lg shadow p-6">
      <div className="flex items-center justify-between mb-4">
        <h2 className="text-xl font-bold">WhatsApp</h2>
        <div className={`w-3 h-3 rounded-full ${statusColors[status?.status] || 'bg-gray-500'}`} />
      </div>

      {status?.status === 'connecting' && status.qrCode && (
        <div className="mb-4 p-4 bg-gray-50 rounded">
          <p className="text-sm text-gray-600 mb-2">–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR –∫–æ–¥:</p>
          <div className="flex justify-center">
            <QRCode value={status.qrCode} size={200} />
          </div>
        </div>
      )}

      <div className="space-y-2">
        <p className="text-sm">
          –°—Ç–∞—Ç—É—Å: <span className="font-semibold">{status?.status}</span>
        </p>
        {status?.lastError && (
          <p className="text-sm text-red-600">–û—à–∏–±–∫–∞: {status.lastError}</p>
        )}
      </div>

      <div className="mt-4 flex gap-2">
        <button
          onClick={() => reconnect.mutate()}
          disabled={reconnect.isPending}
          className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"
        >
          –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å
        </button>
      </div>
    </div>
  );
}
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–í—Å–µ API endpoints –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `/api`**:
   - ‚úÖ `GET /api/status`
   - ‚ùå `GET /status` (–≤—ã–∑–æ–≤–µ—Ç 404)

2. **CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω** - –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –ª—é–±–æ–≥–æ –ø–æ—Ä—Ç–∞

3. **WhatsApp QR –∫–æ–¥** –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ `GET /api/whatsapp/status` –≤ –ø–æ–ª–µ `qrCode`

4. **–ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã** - –ø—Ä–æ—Å—Ç–æ–π toggle, —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ `GET /api/auto-reply`

5. **Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `refetchInterval` –≤ React Query

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ layout.tsx
‚îú‚îÄ‚îÄ page.tsx                    # Dashboard
‚îú‚îÄ‚îÄ whatsapp/
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                # WhatsApp —Å—Ç–∞—Ç—É—Å
‚îú‚îÄ‚îÄ chats/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îî‚îÄ‚îÄ [chatId]/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx
‚îú‚îÄ‚îÄ auto-reply/
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îú‚îÄ‚îÄ style/
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îú‚îÄ‚îÄ reports/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îî‚îÄ‚îÄ [date]/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx
‚îî‚îÄ‚îÄ api/
    ‚îî‚îÄ‚îÄ client.ts               # Axios –∫–ª–∏–µ–Ω—Ç
```

## –ù–∞—á–Ω–∏ —Å —ç—Ç–æ–≥–æ

1. –°–æ–∑–¥–∞–π Next.js –ø—Ä–æ–µ–∫—Ç
2. –ù–∞—Å—Ç—Ä–æ–π API client
3. –°–æ–∑–¥–∞–π Dashboard —Å WhatsApp —Å—Ç–∞—Ç—É—Å–æ–º
4. –î–æ–±–∞–≤—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤
5. –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

**–ì–æ—Ç–æ–≤–æ! –ë—ç–∫–µ–Ω–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤, –≤—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç.**
